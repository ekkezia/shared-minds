<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>PiPiPiP</title>
    <style>
      body,
      button {
        font-family: 'sans-serif' !important;
        margin: 0;
        background: transparent !important;
        border-radius: 8px;
        font-weight: 600 !important;
        color: #36c !important;
      }
      input {
        font-family: Georgia, 'Times New Roman', Times, serif;
      }
      h1 {
        font-family: Georgia, 'Times New Roman', Times, serif;
        color: grey;
      }
      label {
        font-family: Georgia, 'Times New Roman', Times, serif;
        color: black !important;
      }
      button:hover {
        background: #a3d3ff !important;
      }
      .container {
        margin: 0 auto;
      }
      .controls {
        padding: 20px;
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: calc(100dvh; - 201px);
      }
      #tokenStatus {
        font-size: 0.9rem;
        color: #555;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 200px;
        font-family: Georgia, 'Times New Roman', Times, serif;
      }
      .input-group {
        display: flex;
        position: fixed;
        top: 0;
        left: 0;
        width: 100dvw
        display: flex;
        justify-content: space-between;
        gap: 1rem;
      }
      #saveContainer {
        width: 300px;
        display: flex;
      }
      #replicateToken {
        width: 100%;
        height: 1rem;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      label,
      button {
        padding: 8px 12px;
        border-radius: 4px;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      button:disabled {
        background: #6c757d;
        cursor: not-allowed;
      }
      .timeline {
        border-top: 1px dotted blue;
        width: 100dvw
        height: 200px;
        position: fixed;
        bottom: 0;
        left: 0;
        display: flex;
        align-items: center;
        justify-content: start;
        overflow-x: scroll;
        white-space: nowrap;
        cursor: zoom-out;
      }
      .image-item {
        min-width: 200px;
        width: 200px;
        height: fit-content;
        cursor: zoom-in;
        overflow: hidden;
        transition: transform 0.2s;
        box-sizing: content-box;
      }
      .image-item:hover {
        border: 2px dashed #36c;
      }
      .image-item img {
        width: 200px;
        height: 150px;
        object-fit: cover;
        display: block;
      }
      .image-info {
        padding: 8px;
        background: #f8f9fa;
        font-size: 12px;
        color: #666;
        white-space: normal;
        /* width: 100%; */
      }
      .loading {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      }
      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid #007bff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .status {
        margin-top: 10px;
        padding: 10px;
        border-radius: 4px;
        display: none;
      }
      .status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      #uploadImage {
        background-color: #36c;
        border-radius: 8px;
        cursor: pointer;
      }
      .upload-next {
        border: 1px dashed #36c;
        width: 200px;
        min-width: 200px;
        height: 148px;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: translateY(-15px);
        cursor: pointer !important;
      }
      .upload-plus {
        margin-left: 1rem;
        font-size: 24px !important;
        font-weight: bold !important;
        background: transparent;
        color: #36c !important;
        border: none !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        transition: all 0.2s !important;
        margin: 0 !important;
        padding: 0 !important;
        z-index: 1000;
        position: relative;
      }
      .upload-plus:hover {
        background: none;
      }
      .upload-next:hover {
        background: #0056b3 !important;
        .upload-plus {
          color: white !important;
          transform: scale(2) !important;
        }
      }

      .upload-plus:disabled {
        background: #6c757d !important;
        cursor: not-allowed;
        transform: none;
      }

      #add-bbox {
        position: absolute;
        border: 2px dashed fuchsia;
        pointer-events: auto;
        z-index: 1000;
        box-sizing: border-box;
      }

      #viewer {
        /* pointer-events: none; */
        position: fixed;
        top: 0;
        left: 0;
        width: 100dvw /* or 100% if responsive */
        height: calc(100dvh; - 200px);
        overflow: hidden;
        margin: auto;
        /* background: rgba(255,255,255,0.5);
        backdrop-filter: blur(2px); */
        cursor: zoom-in;
      }
      #mainImage {
        width: 100%;
        height: 100%;
        object-fit: contain;
        transform-origin: center center;
        transition: transform 0.2s ease;
      }
      #bbox {
        position: absolute;
        pointer-events: none;
        /* background: rgba(255, 0, 0, 0.5); */
      }
      a {
        text-decoration: none;
      }
      a:hover {
        background: yellow;
      }
      #wikimedia-search {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        gap: 1rem;
      }
      #searchKeyword {
        width: 30vw;
        font-size: 2.5rem;
      }
      #searchBtn {
        font-size: 2.5rem;
        padding: 0.5rem 1rem;
      }
      #mainImage {
        display: none;
      }
      #upload-status {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #36c;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        font-size: 1rem;
        z-index: 10001;
        display: none;
      }
      #add-container {
        background: red;
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
        width: fit-content;
        height: fit-content;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="controls">
        <h1>PiPiPiP</h1>

        <div class="input-group">
          <input
            type="password"
            id="replicateToken"
            placeholder="Enter your Replicate API token"
          />
          <button id="saveToken">Save Token</button>
          <button id="clearToken">Clear Token</button>
          <span id="tokenStatus">No token saved</span>
        </div>

        <div id="status" class="status"></div>
      </div>

      <div class="timeline" id="timeline">
        <div class="loading">Loading...</div>
      </div>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
    </div>

    <div id="viewer">
      <img id="mainImage" src="yourImage.jpg" />
      <div id="bbox"></div>

      <img id="add-image" src="yourImage.jpg" />
      <div id="add-bbox"></div>
      <div
        id="placement-info"
        style="
          margin-top: 8px;
          font-family: monospace;
          font-size: 14px;
          color: #00bcd4;
        "
      ></div>
      <div
        id="hoverLabel"
        style="
          position: absolute;
          padding: 2px 6px;
          background: rgba(0, 0, 0, 0.7);
          color: white;
          font-size: 12px;
          border-radius: 4px;
          pointer-events: none;
          display: none;
          z-index: 9999;
        "
      ></div>
    </div>

    <div id="upload-status" class="upload-status"></div>

    <script type="module" src="index.js"></script>
  </body>
</html>
